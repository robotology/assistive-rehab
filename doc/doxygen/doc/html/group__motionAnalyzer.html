<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>assistive-rehab: motionAnalyzer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">assistive-rehab
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">motionAnalyzer</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module is responsible for analyzing the performed exercise in real-time.  
</p>
<p>This module is responsible for analyzing the performed exercise in real-time. </p>
<p>Version:0.6.0 </p><dl class="section author"><dt>Author</dt><dd>Valentina Vasco <a href="#" onclick="location.href='mai'+'lto:'+'val'+'en'+'tin'+'a.'+'vas'+'co'+'@ii'+'t.'+'it'; return false;">valen<span style="display: none;">.nosp@m.</span>tina<span style="display: none;">.nosp@m.</span>.vasc<span style="display: none;">.nosp@m.</span>o@ii<span style="display: none;">.nosp@m.</span>t.it</a> <br  />
 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Released under the terms of the BSD 3-Clause License. </dd></dl>
<h1><a class="anchor" id="intro_sec"></a>
Description</h1>
<p>This module is responsible for analyzing the performed exercise in real-time. A single exercise has its own metrics and feedback, defined in the related config file, for example abduction left is described in <code>abduction_left.ini</code> file. All the available exercises with related config files are included in the config file <code>motion-repertoire.ini</code>. The available metrics are the range of motion (ROM), end-point (EP) parameters (trajectory, speed and smoothness) and step parameters (step length, step width, cadence and speed), which can be visualized on a yarpscope through the provided API. The module is also responsible for generating matio files in order to produce an offline report. It makes use of matio and hdf5 libraries.</p>
<h2><a class="anchor" id="sec-conf"></a>
Configuration files</h2>
<p>Each exercise has its configuration file which is included in the general config file motion-repertoire.ini. Configuration files are described in the following sections.</p>
<h3><a class="anchor" id="sec-motion-rep"></a>
motion-repertoire.ini</h3>
<p>This section describes the conf file motion-repertoire.ini. This file includes all the configuration files of the single exercises, which are defined by <code>exercises</code>. The labels of the <code>rehabilitation</code> exercises have to match the names of the files loaded by <a class="el" href="group__skeletonPlayer.html">skeletonPlayer</a> and the labels of the classed predicted by <a class="el" href="group__actionRecognizer.html">actionRecognizer</a>.</p>
<p>Each specific file inlcudes the following sections:</p>
<div class="fragment"><div class="line">[general]</div>
<div class="line">type                           rehabilitation</div>
<div class="line"> </div>
<div class="line">[metrics]</div>
<div class="line">tag                            (ROM)</div>
<div class="line">nmetrics                       (1)</div>
</div><!-- fragment --><p>The <code>[general]</code> section describes the kind of exercise (test or rehabilitation). The <code>[metrics]</code> section defines the metrics to be computed for the specific exercise. Exercises tagged as <code>rehabilitation</code> also include an additional <code>[feedback]</code> section, which defines the parameters sent to <a class="el" href="group__feedbackProducer.html">feedbackProducer</a> for providing a feedback to the user.</p>
<h3><a class="anchor" id="sec-abduction"></a>
abduction_left.ini, internal_rotation_left.ini, external_rotation_left.ini</h3>
<p>This section describes the conf file abduction-left.ini, internal_rotation_left.ini, external_rotation_left.ini. For this exercises we compute the range of motion, as angle between the vector formed by the reference joint (<code>tag_joint</code>) and its child (projected onto the projection plane defined by <code>tag_plane</code>) and the reference direction <code>ref_dir</code>, described as following:</p>
<div class="fragment"><div class="line">[ROM_0]</div>
<div class="line">tag_joint                      shoulderLeft</div>
<div class="line">ref_dir                        (0.0 0.0 -1.0)</div>
<div class="line">tag_plane                      coronal</div>
<div class="line">min                            0.0</div>
<div class="line">max                            100.0</div>
</div><!-- fragment --><p>The <code>[feedback]</code> section contains the thresholds required for producing the feedback:</p>
<div class="fragment"><div class="line">[feedback]</div>
<div class="line">duration                       30</div>
<div class="line">twarp                          0.9</div>
<div class="line">joint_list                     (elbowLeft handLeft)</div>
<div class="line">sx_thresh                      (0.5 0.5)</div>
<div class="line">sy_thresh                      (0.5 0.5)</div>
<div class="line">sz_thresh                      (0.2 0.3)</div>
<div class="line">range_freq                     (2 2)</div>
<div class="line">psd_thresh                     (10000.0 10000.0)</div>
</div><!-- fragment --><p>The joints of the skeleton under analysis are defined by <code>joint_list</code>. They are compared to those of a template skeleton, which is reproduced by the <a class="el" href="group__skeletonPlayer.html">skeletonPlayer</a> with a warping factor of <code>twarp</code>. The skeleton is also analyzed by the <a class="el" href="group__actionRecognizer.html">actionRecognizer</a>, which predicts a label for the exercise every <code>duration</code> frames. Such exercises can produce two feedbacks, i.e. on the speed and on the range of motion:</p>
<ul>
<li>range of motion: the error between the observed and template joints under analysis is computed. A statistical analysis is carried out, which looks for tails in the error distribution. <code>sx_thresh</code>, <code>sy_thresh</code> and <code>sz_thresh</code> define, for each joint in <code>joint_list</code>, the thresholds on the standard deviation of the error in position along x, y and z respectively.</li>
<li>speed: we compute the Fourier transform of each component of the joints under analysis in a predefined temporal window, for both the observed and the template skeleton. The difference in speed is proportional to the difference in frequency. <code>range_freq</code> and <code>psd_thresh</code> define, for each joint in <code>joint_list</code>, the thresholds on the difference in frequency and on the power spectrum density between template and observed joints respectively.</li>
</ul>
<h3><a class="anchor" id="sec-reaching"></a>
reaching-left.ini</h3>
<p>This section describes the conf file reaching-left.ini. For this exercise we compute the end point parameters, specifically trajectory, speed and smoothness. The section describing the metric includes the same parameters defined in <a class="el" href="group__motionAnalyzer.html#sec-abduction">abduction_left.ini, internal_rotation_left.ini, external_rotation_left.ini</a>, plus an additional <code>target</code>, which defines the target to reach in the skeleton reference system.</p>
<div class="fragment"><div class="line">[EP_0]</div>
<div class="line">tag_joint                      handLeft</div>
<div class="line">ref_dir                        (0.0 0.0 -1.0)</div>
<div class="line">tag_plane                      sagittal</div>
<div class="line">min                            0.0</div>
<div class="line">max                            5.0</div>
<div class="line">target                         (2.0 1.0 0.0)</div>
</div><!-- fragment --><p>The feedback section differs from the one defined in sec-abduction:</p>
<div class="fragment"><div class="line">[feedback]</div>
<div class="line">duration                       30</div>
<div class="line">twarp                          1.0</div>
<div class="line">joint_list                     (handLeft)</div>
<div class="line">radius                         (1.0)</div>
<div class="line">zscore_thresh                  (2)</div>
<div class="line">inliers_thresh                 (0.3)</div>
</div><!-- fragment --><p>As in <a class="el" href="group__motionAnalyzer.html#sec-abduction">abduction_left.ini, internal_rotation_left.ini, external_rotation_left.ini</a>, the joints under analysis are defined by <code>joint_list</code> and compared to those of a template skeleton, which is reproduced by the <a class="el" href="group__skeletonPlayer.html">skeletonPlayer</a> with a warping factor of <code>twarp</code>. The skeleton is also analyzed by the <a class="el" href="group__actionRecognizer.html">actionRecognizer</a>, which predicts a label for the exercise every <code>duration</code> frames.</p>
<p>Differently than <a class="el" href="group__motionAnalyzer.html#sec-abduction">abduction_left.ini, internal_rotation_left.ini, external_rotation_left.ini</a>, such exercise produces a single feedback, related to how well a predefined target is reached. The target distribution is statistically described by the template points falling inside a sphere around the <code>target</code>, defined by <code>radius</code>. Statistics of the distribution of the observed points are extracted and points whose score is below the <code>zscore_thresh</code> are considered inliers. Finally, if the number of inliers have to be higher than <code>inliers_thresh</code>, the target is considered reached.</p>
<h3><a class="anchor" id="sec-tug"></a>
tug.ini</h3>
<p>This section describes the conf file tug.ini. The <code>general</code> section includes the following parameters:</p>
<div class="fragment"><div class="line">[general]</div>
<div class="line">type                           test</div>
<div class="line">finish-line-thresh             0.3</div>
<div class="line">standing-thresh                0.025</div>
<div class="line">distance                       3.0</div>
<div class="line">time-high                      10.0</div>
<div class="line">time-medium                    20.0</div>
<div class="line">vel_estimator_N                100</div>
<div class="line">vel_estimator_D                5.0</div>
<div class="line">max-finish-line-overrun        0.3</div>
</div><!-- fragment --><p>with:</p><ul>
<li><code>finish-line-thresh</code>: threshold on the distance between foot and finish line [m];</li>
<li><code>standing-thresh</code>: threshold on the speed of the shoulder center height [m/s];</li>
<li><code>distance</code>: the distance to travel [m];</li>
<li><code>time-high</code>: the time the user should take to travel <code>distance</code> and get a high score [s];</li>
<li><code>time-high</code>: the time the user should take to travel <code>distance</code> and get a medium score [s];</li>
<li><code>vel_estimator_N</code>: maximum length of the window used to estimate the shoulder height speed;</li>
<li><code>vel_estimator_D</code>: threshold applied to the linear estimator.</li>
<li><code>max-finish-line-overrun</code>: maximum allowed overrun with respect to the finish line [m];</li>
</ul>
<p>For this exercise we compute the range of motion of six joints and the step parameters, specifically step length, step width, cadence and speed. The sections describing the range of motion metrics are the same defined in <a class="el" href="group__motionAnalyzer.html#sec-abduction">abduction_left.ini, internal_rotation_left.ini, external_rotation_left.ini</a>. There is an additional section for extracting the step parameters:</p>
<div class="fragment"><div class="line">[step_0]</div>
<div class="line">median_filter_window           4</div>
<div class="line">step_thresh                    0.25</div>
<div class="line">step_window                    3</div>
<div class="line">time_window                    3.0</div>
<div class="line">enable_plane_projection        <span class="keyword">false</span></div>
</div><!-- fragment --><p><code>median_filter_window</code> defines the filter parameter applied to the distance between feet for computing the step parameters. A step is identified as occurring between two consecutive maximum values of the distance between the feet. The average step length is evaluated by first computing such distance along the sagittal plane and extracting the last <code>step_window</code> maximum values exceeding <code>step_thresh</code>. Only the maximum values occurring within the last <code>time_window</code> seconds from the last detected step are considered. <code>enable_plane_projection</code> is a flag that enables the projection of the difference between the two ankles on the sagittal and coronal planes of the skeleton.</p>
<h1><a class="anchor" id="parameters_sec"></a>
Parameters</h1>
<ul>
<li>&ndash;name: The module's name; all the open ports will be tagged with the prefix /name</li>
<li>&ndash;from: Configuration file name with the list of exercises that can be analyzed.</li>
<li>&ndash;general::exercises: List of exercises that can be analyzed. </li>
</ul>
<h1><a class="anchor" id="inputports_sec"></a>
Input Ports</h1>
<h1><a class="anchor" id="outputports_sec"></a>
Output Ports</h1>
<ul>
<li>/motionAnalyzer/opc [rpc] [default carrier:]: Sends commands to objectsPropertiesCollector to retrieve 3D skeletons.</li>
<li>/motionAnalyzer/scaler:cmd [rpc] [default carrier:]: Sends commands to <a class="el" href="group__skeletonScaler.html">skeletonScaler</a> to load and move the template skeleton.</li>
<li>/motionAnalyzer/dtw:cmd [rpc] [default carrier:]: Sends commands to <a class="el" href="group__feedbackProducer.html">feedbackProducer</a> to start the analysis for producing feeback.</li>
<li>/motionAnalyzer/action:cmd [rpc] [default carrier:]: Sends commands to <a class="el" href="group__actionRecognizer.html">actionRecognizer</a> to start the action recognition.</li>
<li>/motionAnalyzer/scope [Bottle] [default carrier:]: Outputs a yarp bottle containing the result of the computation along with the ideal value.</li>
</ul>
<h1><a class="anchor" id="services_sec"></a>
Services</h1>
<ul>
<li>/motionAnalyzer/cmd [rpc-server]: service port . This service is described in <a class="el" href="classmotionAnalyzer__IDL.html" title="motionAnalyzer_IDL IDL Interface to Motion Analyzer services.">motionAnalyzer_IDL</a> (idl.thrift) </li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
